package com.responsive.cer.models;

import org.apache.sling.api.resource.Resource;
import org.apache.sling.api.resource.ValueMap;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.Mockito;
import org.powermock.api.mockito.PowerMockito;
import org.powermock.modules.junit4.PowerMockRunner;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;

@RunWith(PowerMockRunner.class)
public class RTEEmojiConfigModelTest {

    private Resource mockResource;
    private Resource emojiConfigResource;
    private Resource emojiConfigsResource;
    private RTEEmojiConfigModel emojiConfigModel;

    @Before
    public void setUp() {
        // Mock the main resource
        mockResource = Mockito.mock(Resource.class);
        
        // Mock the emojiConfig resource
        emojiConfigResource = Mockito.mock(Resource.class);
        Mockito.when(mockResource.getChild("emojiconfig")).thenReturn(emojiConfigResource);
        
        // Mock the emojiConfigs resource
        emojiConfigsResource = Mockito.mock(Resource.class);
        Mockito.when(emojiConfigResource.getChild("emojiConfigs")).thenReturn(emojiConfigsResource);

        // Create and mock emoji resources
        List<Resource> emojiResources = new ArrayList<>();
        emojiResources.add(createMockEmojiResource("item0", "e1-0-grinning-face", "&#128540"));
        emojiResources.add(createMockEmojiResource("item1", "e0-6-grinning-face-with-big-eye", "&#x1F600"));

        // Set up the emojiConfigsResource to return the emoji resources
        Mockito.when(emojiConfigsResource.listChildren()).thenAnswer(invocation -> emojiResources.iterator());

        // Initialize the emojiConfigModel
        emojiConfigModel = new RTEEmojiConfigModel(mockResource);
    }

    private Resource createMockEmojiResource(String name, String emojiName, String emojiValue) {
        Resource emojiResource = Mockito.mock(Resource.class);
        ValueMap valueMap = Mockito.mock(ValueMap.class);
        Mockito.when(valueMap.get("emojiName", String.class)).thenReturn(emojiName);
        Mockito.when(valueMap.get("emojiValue", String.class)).thenReturn(emojiValue);

        Mockito.when(emojiResource.adaptTo(ValueMap.class)).thenReturn(valueMap);
        return emojiResource;
    }

    @Test
    public void testGetEmojiConfigs() {
        List<RTEEmojiConfigBean> emojiBeans = emojiConfigModel.getEmojiConfigs();

        assertNotNull("EmojiConfigModel should not be null", emojiConfigModel);
        assertEquals("Expected 2 emoji configs", 2, emojiBeans.size());
    }
}
