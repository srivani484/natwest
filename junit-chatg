package com.responsive.cer.models;

import org.apache.sling.testing.junit.rules.AemContext;
import org.junit.Rule;
import org.junit.Test;
import org.apache.sling.api.resource.Resource;

import java.util.List;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;

public class RTEEmojiConfigModelTest {

    @Rule
    public AemContext context = new AemContext();

    @Test
    public void testGetEmojiConfigs() {
        // Create a page resource with primary type and created by properties
        context.create().resource("/content/test-page", 
                                   "jcr:primaryType", "cq:Page", 
                                   "jcr:createdBy", "admin");

        // Create a content resource for the page
        Resource pageResource = context.resourceResolver().getResource("/content/test-page/jcr:content");
        context.create().resource(pageResource, "master-par", 
                                   "jcr:primaryType", "nt:unstructured",
                                   "sling:resourceType", "wcm/foundation/components/responsivegrid");

        // Create the emojiconfig resource
        Resource emojiconfigResource = context.create().resource(pageResource, "emojiconfig",
                "jcr:primaryType", "nt:unstructured",
                "sling:resourceType", "responsive/components/configs/emojiconfig",
                "jcr:createdBy", "admin",
                "jcr:lastModifiedBy", "admin",
                "jcr:created", "Thu Oct 17 2024 12:42:12 GMT+0100",
                "jcr:lastModified", "Thu Oct 17 2024 12:43:59 GMT+0100");

        // Create the emojiConfigs parent resource
        Resource emojiConfigsResource = context.create().resource(emojiconfigResource, "emojiConfigs",
                "jcr:primaryType", "nt:unstructured");

        // Create child resources for individual emojis
        context.create().resource(emojiConfigsResource, "item0",
                "jcr:primaryType", "nt:unstructured",
                "emojiName", "e1-0-grinning-face",
                "emojiValue", "&#128540");
        context.create().resource(emojiConfigsResource, "item1",
                "jcr:primaryType", "nt:unstructured",
                "emojiName", "e0-6-grinning-face-with-big-eye",
                "emojiValue", "&#x1F600");

        // Adapt the emojiconfig resource to the RTEEmojiConfigModel
        RTEEmojiConfigModel emojiConfigModel = emojiconfigResource.adaptTo(RTEEmojiConfigModel.class);

        // Assertions
        assertNotNull(emojiConfigModel);
        List<RTEEmojiConfigBean> emojiConfigs = emojiConfigModel.getEmojiConfigs();
        assertNotNull(emojiConfigs);
        assertEquals(2, emojiConfigs.size());

        // Verify the properties of each RTEEmojiConfigBean
        assertEquals("e1-0-grinning-face", emojiConfigs.get(0).getEmojiName());
        assertEquals("&#128540", emojiConfigs.get(0).getEmojiValue());

        assertEquals("e0-6-grinning-face-with-big-eye", emojiConfigs.get(1).getEmojiName());
        assertEquals("&#x1F600", emojiConfigs.get(1).getEmojiValue());
    }
}
